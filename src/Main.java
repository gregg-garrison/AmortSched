import java.time.LocalDate;
import java.time.ZoneId;
import java.util.ArrayList;
import java.util.Date;
import java.util.List;


public class Main {
	public static void main(String[] args) {
		Date today = new Date();
		LocalDate sDate = today.toInstant().atZone(ZoneId.systemDefault()).toLocalDate();
		int dayMonth = sDate.getDayOfMonth();
		
		Loan loan1 = new Loan(1,100000.0,0.05,360,today);
		Double monthlyTotal = monthlyPayment(loan1.getInitialValue(),loan1.getRate()/12,loan1.getTerm());
		loan1.setPayment(monthlyTotal);
		
		List<Transaction> amort = getAmortSchedule(loan1);
		loan1.setSchedule(amort);
		amort.forEach(System.out::print);
	}
	
	//*****HELPER FUNCTIONS BELOW*******
	
	public static List<Transaction> getAmortSchedule(Loan loan){
		List<Transaction> list = new ArrayList<>();
		Transaction trans = new Transaction();
		double principal = loan.getInitialValue();
		double apr = loan.getRate();
		int term = loan.getTerm();
		int paymentNum;
		double payment = loan.getPayment();
		double interestPayment, principalPayment, newBalance;
		Date startDate = loan.getStartDate();
		LocalDate date = startDate.toInstant().atZone(ZoneId.systemDefault()).toLocalDate();
		int dayMonth = date.getDayOfMonth();
		
		for(int i=1;i<=term;i++) {
			paymentNum = i;
			LocalDate pmtDate = next(date,dayMonth);
			interestPayment = principal * (apr/12);
			principalPayment = payment - interestPayment;
			newBalance = principal - principalPayment;
			principal = newBalance;
			trans = new Transaction(paymentNum,interestPayment,principalPayment,loan,newBalance,pmtDate);
			list.add(trans);
			
			loan.setBalance(newBalance);
			date = pmtDate;
		}
		return list;
	}
	
	public static LocalDate next(LocalDate current, int selectedDayOfMonth) {
		LocalDate next = current.plusMonths(1);
		return next.withDayOfMonth(Math.min(selectedDayOfMonth, next.lengthOfMonth()));
	}
	
	static double monthlyPayment(double loanAmount, double monthlyInterestRate, int term) {
		return loanAmount * monthlyInterestRate /
				(1 - 1 / Math.pow(1 + monthlyInterestRate, term));
	}
}

//Returns the following
//1 2021-02-15     416.67     120.15     99879.85
//2 2021-03-15     416.17     120.66     99759.19
//3 2021-04-15     415.66     121.16     99638.03
//4 2021-05-15     415.16     121.66     99516.37
//5 2021-06-15     414.65     122.17     99394.20
//6 2021-07-15     414.14     122.68     99271.52
//7 2021-08-15     413.63     123.19     99148.33
//8 2021-09-15     413.12     123.70     99024.62
//9 2021-10-15     412.60     124.22     98900.41
//10 2021-11-15     412.09     124.74     98775.67
//11 2021-12-15     411.57     125.26     98650.41
//12 2022-01-15     411.04     125.78     98524.63
//13 2022-02-15     410.52     126.30     98398.33
//14 2022-03-15     409.99     126.83     98271.50
//15 2022-04-15     409.46     127.36     98144.15
//16 2022-05-15     408.93     127.89     98016.26
//17 2022-06-15     408.40     128.42     97887.84
//18 2022-07-15     407.87     128.96     97758.88
//19 2022-08-15     407.33     129.49     97629.39
//20 2022-09-15     406.79     130.03     97499.36
//21 2022-10-15     406.25     130.57     97368.78
//22 2022-11-15     405.70     131.12     97237.66
//23 2022-12-15     405.16     131.66     97106.00
//24 2023-01-15     404.61     132.21     96973.79
//25 2023-02-15     404.06     132.76     96841.02
//26 2023-03-15     403.50     133.32     96707.71
//27 2023-04-15     402.95     133.87     96573.83
//28 2023-05-15     402.39     134.43     96439.40
//29 2023-06-15     401.83     134.99     96304.41
//30 2023-07-15     401.27     135.55     96168.86
//31 2023-08-15     400.70     136.12     96032.74
//32 2023-09-15     400.14     136.69     95896.05
//33 2023-10-15     399.57     137.25     95758.80
//34 2023-11-15     398.99     137.83     95620.97
//35 2023-12-15     398.42     138.40     95482.57
//36 2024-01-15     397.84     138.98     95343.59
//37 2024-02-15     397.26     139.56     95204.04
//38 2024-03-15     396.68     140.14     95063.90
//39 2024-04-15     396.10     140.72     94923.18
//40 2024-05-15     395.51     141.31     94781.87
//41 2024-06-15     394.92     141.90     94639.97
//42 2024-07-15     394.33     142.49     94497.48
//43 2024-08-15     393.74     143.08     94354.40
//44 2024-09-15     393.14     143.68     94210.72
//45 2024-10-15     392.54     144.28     94066.45
//46 2024-11-15     391.94     144.88     93921.57
//47 2024-12-15     391.34     145.48     93776.09
//48 2025-01-15     390.73     146.09     93630.00
//49 2025-02-15     390.12     146.70     93483.30
//50 2025-03-15     389.51     147.31     93335.99
//51 2025-04-15     388.90     147.92     93188.07
//52 2025-05-15     388.28     148.54     93039.53
//53 2025-06-15     387.66     149.16     92890.38
//54 2025-07-15     387.04     149.78     92740.60
//55 2025-08-15     386.42     150.40     92590.20
//56 2025-09-15     385.79     151.03     92439.17
//57 2025-10-15     385.16     151.66     92287.51
//58 2025-11-15     384.53     152.29     92135.22
//59 2025-12-15     383.90     152.92     91982.29
//60 2026-01-15     383.26     153.56     91828.73
//61 2026-02-15     382.62     154.20     91674.53
//62 2026-03-15     381.98     154.84     91519.69
//63 2026-04-15     381.33     155.49     91364.20
//64 2026-05-15     380.68     156.14     91208.06
//65 2026-06-15     380.03     156.79     91051.27
//66 2026-07-15     379.38     157.44     90893.83
//67 2026-08-15     378.72     158.10     90735.73
//68 2026-09-15     378.07     158.76     90576.98
//69 2026-10-15     377.40     159.42     90417.56
//70 2026-11-15     376.74     160.08     90257.48
//71 2026-12-15     376.07     160.75     90096.73
//72 2027-01-15     375.40     161.42     89935.31
//73 2027-02-15     374.73     162.09     89773.22
//74 2027-03-15     374.06     162.77     89610.45
//75 2027-04-15     373.38     163.44     89447.01
//76 2027-05-15     372.70     164.13     89282.88
//77 2027-06-15     372.01     164.81     89118.07
//78 2027-07-15     371.33     165.50     88952.58
//79 2027-08-15     370.64     166.19     88786.39
//80 2027-09-15     369.94     166.88     88619.51
//81 2027-10-15     369.25     167.57     88451.94
//82 2027-11-15     368.55     168.27     88283.67
//83 2027-12-15     367.85     168.97     88114.69
//84 2028-01-15     367.14     169.68     87945.02
//85 2028-02-15     366.44     170.38     87774.63
//86 2028-03-15     365.73     171.09     87603.54
//87 2028-04-15     365.01     171.81     87431.73
//88 2028-05-15     364.30     172.52     87259.21
//89 2028-06-15     363.58     173.24     87085.97
//90 2028-07-15     362.86     173.96     86912.00
//91 2028-08-15     362.13     174.69     86737.31
//92 2028-09-15     361.41     175.42     86561.90
//93 2028-10-15     360.67     176.15     86385.75
//94 2028-11-15     359.94     176.88     86208.87
//95 2028-12-15     359.20     177.62     86031.25
//96 2029-01-15     358.46     178.36     85852.89
//97 2029-02-15     357.72     179.10     85673.79
//98 2029-03-15     356.97     179.85     85493.95
//99 2029-04-15     356.22     180.60     85313.35
//100 2029-05-15     355.47     181.35     85132.00
//101 2029-06-15     354.72     182.10     84949.89
//102 2029-07-15     353.96     182.86     84767.03
//103 2029-08-15     353.20     183.63     84583.40
//104 2029-09-15     352.43     184.39     84399.01
//105 2029-10-15     351.66     185.16     84213.85
//106 2029-11-15     350.89     185.93     84027.92
//107 2029-12-15     350.12     186.71     83841.22
//108 2030-01-15     349.34     187.48     83653.74
//109 2030-02-15     348.56     188.26     83465.47
//110 2030-03-15     347.77     189.05     83276.42
//111 2030-04-15     346.99     189.84     83086.59
//112 2030-05-15     346.19     190.63     82895.96
//113 2030-06-15     345.40     191.42     82704.54
//114 2030-07-15     344.60     192.22     82512.32
//115 2030-08-15     343.80     193.02     82319.30
//116 2030-09-15     343.00     193.82     82125.47
//117 2030-10-15     342.19     194.63     81930.84
//118 2030-11-15     341.38     195.44     81735.40
//119 2030-12-15     340.56     196.26     81539.14
//120 2031-01-15     339.75     197.08     81342.06
//121 2031-02-15     338.93     197.90     81144.17
//122 2031-03-15     338.10     198.72     80945.45
//123 2031-04-15     337.27     199.55     80745.90
//124 2031-05-15     336.44     200.38     80545.52
//125 2031-06-15     335.61     201.22     80344.30
//126 2031-07-15     334.77     202.05     80142.25
//127 2031-08-15     333.93     202.90     79939.35
//128 2031-09-15     333.08     203.74     79735.61
//129 2031-10-15     332.23     204.59     79531.02
//130 2031-11-15     331.38     205.44     79325.58
//131 2031-12-15     330.52     206.30     79119.28
//132 2032-01-15     329.66     207.16     78912.12
//133 2032-02-15     328.80     208.02     78704.10
//134 2032-03-15     327.93     208.89     78495.21
//135 2032-04-15     327.06     209.76     78285.46
//136 2032-05-15     326.19     210.63     78074.82
//137 2032-06-15     325.31     211.51     77863.31
//138 2032-07-15     324.43     212.39     77650.92
//139 2032-08-15     323.55     213.28     77437.65
//140 2032-09-15     322.66     214.16     77223.48
//141 2032-10-15     321.76     215.06     77008.43
//142 2032-11-15     320.87     215.95     76792.47
//143 2032-12-15     319.97     216.85     76575.62
//144 2033-01-15     319.07     217.76     76357.86
//145 2033-02-15     318.16     218.66     76139.20
//146 2033-03-15     317.25     219.57     75919.62
//147 2033-04-15     316.33     220.49     75699.13
//148 2033-05-15     315.41     221.41     75477.73
//149 2033-06-15     314.49     222.33     75255.39
//150 2033-07-15     313.56     223.26     75032.14
//151 2033-08-15     312.63     224.19     74807.95
//152 2033-09-15     311.70     225.12     74582.83
//153 2033-10-15     310.76     226.06     74356.77
//154 2033-11-15     309.82     227.00     74129.77
//155 2033-12-15     308.87     227.95     73901.82
//156 2034-01-15     307.92     228.90     73672.92
//157 2034-02-15     306.97     229.85     73443.07
//158 2034-03-15     306.01     230.81     73212.26
//159 2034-04-15     305.05     231.77     72980.49
//160 2034-05-15     304.09     232.74     72747.75
//161 2034-06-15     303.12     233.71     72514.05
//162 2034-07-15     302.14     234.68     72279.37
//163 2034-08-15     301.16     235.66     72043.71
//164 2034-09-15     300.18     236.64     71807.07
//165 2034-10-15     299.20     237.63     71569.45
//166 2034-11-15     298.21     238.62     71330.83
//167 2034-12-15     297.21     239.61     71091.22
//168 2035-01-15     296.21     240.61     70850.61
//169 2035-02-15     295.21     241.61     70609.00
//170 2035-03-15     294.20     242.62     70366.38
//171 2035-04-15     293.19     243.63     70122.76
//172 2035-05-15     292.18     244.64     69878.11
//173 2035-06-15     291.16     245.66     69632.45
//174 2035-07-15     290.14     246.69     69385.76
//175 2035-08-15     289.11     247.71     69138.05
//176 2035-09-15     288.08     248.75     68889.30
//177 2035-10-15     287.04     249.78     68639.52
//178 2035-11-15     286.00     250.82     68388.70
//179 2035-12-15     284.95     251.87     68136.83
//180 2036-01-15     283.90     252.92     67883.91
//181 2036-02-15     282.85     253.97     67629.94
//182 2036-03-15     281.79     255.03     67374.91
//183 2036-04-15     280.73     256.09     67118.81
//184 2036-05-15     279.66     257.16     66861.65
//185 2036-06-15     278.59     258.23     66603.42
//186 2036-07-15     277.51     259.31     66344.11
//187 2036-08-15     276.43     260.39     66083.73
//188 2036-09-15     275.35     261.47     65822.25
//189 2036-10-15     274.26     262.56     65559.69
//190 2036-11-15     273.17     263.66     65296.04
//191 2036-12-15     272.07     264.75     65031.28
//192 2037-01-15     270.96     265.86     64765.42
//193 2037-02-15     269.86     266.97     64498.46
//194 2037-03-15     268.74     268.08     64230.38
//195 2037-04-15     267.63     269.20     63961.18
//196 2037-05-15     266.50     270.32     63690.87
//197 2037-06-15     265.38     271.44     63419.42
//198 2037-07-15     264.25     272.57     63146.85
//199 2037-08-15     263.11     273.71     62873.14
//200 2037-09-15     261.97     274.85     62598.29
//201 2037-10-15     260.83     276.00     62322.30
//202 2037-11-15     259.68     277.15     62045.15
//203 2037-12-15     258.52     278.30     61766.85
//204 2038-01-15     257.36     279.46     61487.39
//205 2038-02-15     256.20     280.62     61206.77
//206 2038-03-15     255.03     281.79     60924.97
//207 2038-04-15     253.85     282.97     60642.00
//208 2038-05-15     252.68     284.15     60357.86
//209 2038-06-15     251.49     285.33     60072.53
//210 2038-07-15     250.30     286.52     59786.01
//211 2038-08-15     249.11     287.71     59498.29
//212 2038-09-15     247.91     288.91     59209.38
//213 2038-10-15     246.71     290.12     58919.27
//214 2038-11-15     245.50     291.32     58627.94
//215 2038-12-15     244.28     292.54     58335.40
//216 2039-01-15     243.06     293.76     58041.65
//217 2039-02-15     241.84     294.98     57746.66
//218 2039-03-15     240.61     296.21     57450.45
//219 2039-04-15     239.38     297.44     57153.01
//220 2039-05-15     238.14     298.68     56854.33
//221 2039-06-15     236.89     299.93     56554.40
//222 2039-07-15     235.64     301.18     56253.22
//223 2039-08-15     234.39     302.43     55950.79
//224 2039-09-15     233.13     303.69     55647.09
//225 2039-10-15     231.86     304.96     55342.13
//226 2039-11-15     230.59     306.23     55035.90
//227 2039-12-15     229.32     307.51     54728.40
//228 2040-01-15     228.03     308.79     54419.61
//229 2040-02-15     226.75     310.07     54109.54
//230 2040-03-15     225.46     311.37     53798.17
//231 2040-04-15     224.16     312.66     53485.51
//232 2040-05-15     222.86     313.97     53171.55
//233 2040-06-15     221.55     315.27     52856.27
//234 2040-07-15     220.23     316.59     52539.68
//235 2040-08-15     218.92     317.91     52221.78
//236 2040-09-15     217.59     319.23     51902.55
//237 2040-10-15     216.26     320.56     51581.99
//238 2040-11-15     214.92     321.90     51260.09
//239 2040-12-15     213.58     323.24     50936.85
//240 2041-01-15     212.24     324.58     50612.27
//241 2041-02-15     210.88     325.94     50286.33
//242 2041-03-15     209.53     327.30     49959.04
//243 2041-04-15     208.16     328.66     49630.38
//244 2041-05-15     206.79     330.03     49300.35
//245 2041-06-15     205.42     331.40     48968.94
//246 2041-07-15     204.04     332.78     48636.16
//247 2041-08-15     202.65     334.17     48301.99
//248 2041-09-15     201.26     335.56     47966.43
//249 2041-10-15     199.86     336.96     47629.46
//250 2041-11-15     198.46     338.37     47291.10
//251 2041-12-15     197.05     339.78     46951.32
//252 2042-01-15     195.63     341.19     46610.13
//253 2042-02-15     194.21     342.61     46267.52
//254 2042-03-15     192.78     344.04     45923.48
//255 2042-04-15     191.35     345.47     45578.01
//256 2042-05-15     189.91     346.91     45231.09
//257 2042-06-15     188.46     348.36     44882.73
//258 2042-07-15     187.01     349.81     44532.92
//259 2042-08-15     185.55     351.27     44181.66
//260 2042-09-15     184.09     352.73     43828.92
//261 2042-10-15     182.62     354.20     43474.72
//262 2042-11-15     181.14     355.68     43119.05
//263 2042-12-15     179.66     357.16     42761.89
//264 2043-01-15     178.17     358.65     42403.24
//265 2043-02-15     176.68     360.14     42043.10
//266 2043-03-15     175.18     361.64     41681.46
//267 2043-04-15     173.67     363.15     41318.31
//268 2043-05-15     172.16     364.66     40953.65
//269 2043-06-15     170.64     366.18     40587.46
//270 2043-07-15     169.11     367.71     40219.76
//271 2043-08-15     167.58     369.24     39850.52
//272 2043-09-15     166.04     370.78     39479.74
//273 2043-10-15     164.50     372.32     39107.42
//274 2043-11-15     162.95     373.87     38733.54
//275 2043-12-15     161.39     375.43     38358.11
//276 2044-01-15     159.83     377.00     37981.11
//277 2044-02-15     158.25     378.57     37602.55
//278 2044-03-15     156.68     380.14     37222.40
//279 2044-04-15     155.09     381.73     36840.68
//280 2044-05-15     153.50     383.32     36457.36
//281 2044-06-15     151.91     384.92     36072.44
//282 2044-07-15     150.30     386.52     35685.92
//283 2044-08-15     148.69     388.13     35297.79
//284 2044-09-15     147.07     389.75     34908.04
//285 2044-10-15     145.45     391.37     34516.67
//286 2044-11-15     143.82     393.00     34123.67
//287 2044-12-15     142.18     394.64     33729.03
//288 2045-01-15     140.54     396.28     33332.75
//289 2045-02-15     138.89     397.94     32934.81
//290 2045-03-15     137.23     399.59     32535.22
//291 2045-04-15     135.56     401.26     32133.96
//292 2045-05-15     133.89     402.93     31731.03
//293 2045-06-15     132.21     404.61     31326.42
//294 2045-07-15     130.53     406.29     30920.12
//295 2045-08-15     128.83     407.99     30512.14
//296 2045-09-15     127.13     409.69     30102.45
//297 2045-10-15     125.43     411.39     29691.05
//298 2045-11-15     123.71     413.11     29277.95
//299 2045-12-15     121.99     414.83     28863.12
//300 2046-01-15     120.26     416.56     28446.56
//301 2046-02-15     118.53     418.29     28028.26
//302 2046-03-15     116.78     420.04     27608.23
//303 2046-04-15     115.03     421.79     27186.44
//304 2046-05-15     113.28     423.54     26762.89
//305 2046-06-15     111.51     425.31     26337.58
//306 2046-07-15     109.74     427.08     25910.50
//307 2046-08-15     107.96     428.86     25481.64
//308 2046-09-15     106.17     430.65     25050.99
//309 2046-10-15     104.38     432.44     24618.55
//310 2046-11-15     102.58     434.24     24184.31
//311 2046-12-15     100.77     436.05     23748.25
//312 2047-01-15      98.95     437.87     23310.38
//313 2047-02-15      97.13     439.70     22870.69
//314 2047-03-15      95.29     441.53     22429.16
//315 2047-04-15      93.45     443.37     21985.79
//316 2047-05-15      91.61     445.21     21540.58
//317 2047-06-15      89.75     447.07     21093.51
//318 2047-07-15      87.89     448.93     20644.58
//319 2047-08-15      86.02     450.80     20193.77
//320 2047-09-15      84.14     452.68     19741.09
//321 2047-10-15      82.25     454.57     19286.53
//322 2047-11-15      80.36     456.46     18830.07
//323 2047-12-15      78.46     458.36     18371.70
//324 2048-01-15      76.55     460.27     17911.43
//325 2048-02-15      74.63     462.19     17449.24
//326 2048-03-15      72.71     464.12     16985.12
//327 2048-04-15      70.77     466.05     16519.07
//328 2048-05-15      68.83     467.99     16051.08
//329 2048-06-15      66.88     469.94     15581.14
//330 2048-07-15      64.92     471.90     15109.24
//331 2048-08-15      62.96     473.87     14635.37
//332 2048-09-15      60.98     475.84     14159.53
//333 2048-10-15      59.00     477.82     13681.71
//334 2048-11-15      57.01     479.81     13201.89
//335 2048-12-15      55.01     481.81     12720.08
//336 2049-01-15      53.00     483.82     12236.26
//337 2049-02-15      50.98     485.84     11750.42
//338 2049-03-15      48.96     487.86     11262.56
//339 2049-04-15      46.93     489.89     10772.66
//340 2049-05-15      44.89     491.94     10280.73
//341 2049-06-15      42.84     493.99      9786.74
//342 2049-07-15      40.78     496.04      9290.70
//343 2049-08-15      38.71     498.11      8792.59
//344 2049-09-15      36.64     500.19      8292.40
//345 2049-10-15      34.55     502.27      7790.13
//346 2049-11-15      32.46     504.36      7285.77
//347 2049-12-15      30.36     506.46      6779.31
//348 2050-01-15      28.25     508.57      6270.73
//349 2050-02-15      26.13     510.69      5760.04
//350 2050-03-15      24.00     512.82      5247.22
//351 2050-04-15      21.86     514.96      4732.26
//352 2050-05-15      19.72     517.10      4215.16
//353 2050-06-15      17.56     519.26      3695.90
//354 2050-07-15      15.40     521.42      3174.47
//355 2050-08-15      13.23     523.59      2650.88
//356 2050-09-15      11.05     525.78      2125.10
//357 2050-10-15       8.85     527.97      1597.14
//358 2050-11-15       6.65     530.17      1066.97
//359 2050-12-15       4.45     532.38       534.59
//360 2051-01-15       2.23     534.59        -0.00

